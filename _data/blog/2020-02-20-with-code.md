---
template: BlogPost
path: /with-code
date: 2020-02-20T15:08:12.174Z
title: Code with Syntax Highlighting with PrismJS
metaDescription: k8 kubernetes containers kubernetes/labs labs
thumbnail: ''
---
# Kubernetes-101: Lab:01 - PODS


## Pod
> A *Pod* (as in a pod of whales or pea pod) is a group of one or more  containers (such as Docker containers), with shared storage/network, and a specification for how to run the containers. A Pod’s contents are always co-located and co-scheduled, and run in a shared context. A Pod models an application-specific “logical host” - it contains one or more application containers which are relatively tightly coupled — in a pre-container world, being executed on the same physical or virtual machine would mean being executed on the same logical host.  - [source](https://kubernetes.io/)  

## Motivation
> Pods are a model of the pattern of multiple cooperating processes which form a cohesive unit of service. They simplify application deployment and management by providing a higher-level abstraction than the set of their constituent applications. Pods serve as unit of deployment, horizontal scaling, and replication. Colocation (co-scheduling), shared fate (e.g. termination), coordinated replication, resource sharing, and dependency management are handled automatically for containers in a Pod. - [source](https://kubernetes.io/)  

## Kubernetes Concept

![](blog-bytemethods/blob/master/static/assets/pod.png)

## Sequence Diagram

![](blog-bytemethods/blob/master/static/assets/pod-create.png)

## Questions

#### Determine number of Nodes that are part of the current cluster?
##### Command: `kubectl get nodes`

```sh
hugomatus@cloudshell:**~ (binaria-273402)**$ kubectl get nodes
NAME                                      STATUS   ROLES    AGE   VERSION
gke-orion-k8-default-pool-55aa1bf3-87rk   Ready    <none>   22h   v1.17.5-gke.9
gke-orion-k8-default-pool-55aa1bf3-96ct   Ready    <none>   22h   v1.17.5-gke.9
gke-orion-k8-default-pool-55aa1bf3-fjcj   Ready    <none>   22h   v1.17.5-gke.9
```

#### Create a new pod with the following spec.
##### Spec:
* Name: nginx
* Image name: nginx
* Namespace: default

##### Command: `kubectl run`

```sh
hugomatus@cloudshell:~ (binaria-273402)$ kubectl run nginx --image=nginx --restart=Never
pod/nginx created
```

##### Command: `kubectl get pods`

```sh
hugomatus@cloudshell:**~ (binaria-273402)**$ kubectl get pods
NAME    READY   STATUS    RESTARTS   AGE
nginx   1/1     Running   0          21s
```

### Get a Shell into the following pod:
##### Spec:
* Name: nginx
* Namespace: default

##### Command: `kubectl exec`

```sh
hugomatus@cloudshell:~ (binaria-273402)$ kubectl exec -i -t nginx -- /bin/bash
root@nginx:/# 
```

##### Command: `ls -al`

```sh
root@nginx:/# ls -al
total 88
drwxr-xr-x   1 root root 4096 Jun 12 21:54 .
drwxr-xr-x   1 root root 4096 Jun 12 21:54 ..
-rwxr-xr-x   1 root root    0 Jun 12 21:54 .dockerenv
drwxr-xr-x   2 root root 4096 Jun  7 00:00 bin
drwxr-xr-x   2 root root 4096 May  2 16:39 boot
drwxr-xr-x   5 root root  360 Jun 12 21:54 dev
drwxr-xr-x   1 root root 4096 Jun  9 16:57 docker-entrypoint.d
-rwxrwxr-x   1 root root 1087 Jun  9 16:57 docker-entrypoint.sh
drwxr-xr-x   1 root root 4096 Jun 12 21:54 etc
drwxr-xr-x   2 root root 4096 May  2 16:39 home
drwxr-xr-x   1 root root 4096 Jun  9 16:57 lib
drwxr-xr-x   2 root root 4096 Jun  7 00:00 lib64
drwxr-xr-x   2 root root 4096 Jun  7 00:00 media
drwxr-xr-x   2 root root 4096 Jun  7 00:00 mnt
drwxr-xr-x   2 root root 4096 Jun  7 00:00 opt
dr-xr-xr-x 143 root root    0 Jun 12 21:54 proc
drwx------   2 root root 4096 Jun  7 00:00 root
drwxr-xr-x   1 root root 4096 Jun 12 21:54 run
drwxr-xr-x   2 root root 4096 Jun  7 00:00 sbin
drwxr-xr-x   2 root root 4096 Jun  7 00:00 srv
dr-xr-xr-x  12 root root    0 Jun 12 21:54 sys
drwxrwxrwt   1 root root 4096 Jun  9 16:57 tmp
drwxr-xr-x   1 root root 4096 Jun  7 00:00 usr
drwxr-xr-x   1 root root 4096 Jun  7 00:00 var
```

##### Command: `cat`

```sh
root@nginx:/# cat /etc/hosts
# Kubernetes-managed hosts file.
127.0.0.1       localhost
::1     localhost ip6-localhost ip6-loopback
fe00::0 ip6-localnet
fe00::0 ip6-mcastprefix
fe00::1 ip6-allnodes
fe00::2 ip6-allrouters
10.24.1.8       nginx
```

### Run ‘env’ command in the following pod:
##### Spec:
* Name: nginx
* Namespace: default

##### Command: `kubectl exec`

```sh
hugomatus@cloudshell:~ (binaria-273402)$ kubectl exec nginx -- env

PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
HOSTNAME=nginx
KUBERNETES_PORT_443_TCP_ADDR=10.217.0.1
KUBERNETES_SERVICE_HOST=10.217.0.1
KUBERNETES_SERVICE_PORT=443
KUBERNETES_SERVICE_PORT_HTTPS=443
KUBERNETES_PORT=tcp://10.217.0.1:443
KUBERNETES_PORT_443_TCP=tcp://10.217.0.1:443
KUBERNETES_PORT_443_TCP_PROTO=tcp
KUBERNETES_PORT_443_TCP_PORT=443
NGINX_VERSION=1.19.0
NJS_VERSION=0.4.1
PKG_RELEASE=1~buster
HOME=/root
```

### Run ‘curl’ in the following pod:
##### Spec:
* Name: nginx
* Namespace: default

##### Command: `kubectl exec`

```html
hugomatus@cloudshell:~ (binaria-273402)$ kubectl exec nginx -- curl http://localhost/
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   612  100   612    0     0   149k      0 --:--:-- --:--:-- --:--:--  149k

<!DOCTYPE html>
<html>
<head>
<title>Welcome to nginx!</title>
<style>
    body {
        width: 35em;
        margin: 0 auto;
        font-family: Tahoma, Verdana, Arial, sans-serif;
    }
</style>
</head>
<body>
<h1>Welcome to nginx!</h1>
<p>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.</p>

<p>For online documentation and support please refer to
<a href="http://nginx.org/">nginx.org</a>.<br/>
Commercial support is available at
<a href="http://nginx.com/">nginx.com</a>.</p>

<p><em>Thank you for using nginx.</em></p>
</body>
</html>
```

### Create a new pod with the following spec
##### Spec:
* Name: nginx-app
* Image name: nginx:212
* Namespace: default

##### Command: `kubectl run`

```sh
kubectl run nginx-app --image=nginx:212 --restart=Never
```

```sh
hugomatus@cloudshell:**~ (binaria-273402)**$ kubectl get pods
NAME        READY   STATUS         RESTARTS   AGE
nginx       1/1     Running        0          3m6s
nginx-app   0/1     ErrImagePull   0          5s
```

### Inspect  the running Pod “nginx-app”
##### Command: `kubectl get pods -o`

```yaml
hugomatus@cloudshell:~ (binaria-273402)$ kubectl get pod nginx-app -o yaml

apiVersion: v1
kind: Pod
metadata:
  annotations:
    cni.projectcalico.org/podIP: 10.24.0.14/32
  creationTimestamp: "2020-06-12T19:02:50Z"
  labels:
    run: nginx-app
  name: nginx-app
  namespace: default
  resourceVersion: "484220"
  selfLink: /api/v1/namespaces/default/pods/nginx-app
  uid: 1e640a96-f692-4e5d-961e-f3f16552ae9a
spec:
  containers:
  - image: nginx:212
    imagePullPolicy: Always
    name: nginx-app
    resources: {}
    terminationMessagePath: /dev/termination-log
    terminationMessagePolicy: File
    volumeMounts:
    - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
      name: default-token-cqt2q
      readOnly: true
  dnsPolicy: ClusterFirst
  enableServiceLinks: true
  nodeName: gke-orion-k8-default-pool-55aa1bf3-fjcj
  priority: 0
  restartPolicy: Never
  schedulerName: default-scheduler
  securityContext: {}
  serviceAccount: default
  serviceAccountName: default
  terminationGracePeriodSeconds: 30
  tolerations:
  - effect: NoExecute
    key: node.kubernetes.io/not-ready
    operator: Exists
    tolerationSeconds: 300
  - effect: NoExecute
    key: node.kubernetes.io/unreachable
    operator: Exists
    tolerationSeconds: 300
  volumes:
  - name: default-token-cqt2q
    secret:
      defaultMode: 420
      secretName: default-token-cqt2q
status:
  conditions:
  - lastProbeTime: null
    lastTransitionTime: "2020-06-12T19:02:50Z"
    status: "True"
    type: Initialized
  - lastProbeTime: null
    lastTransitionTime: "2020-06-12T19:02:50Z"
    message: 'containers with unready status: [nginx-app]'
    reason: ContainersNotReady
    status: "False"
    type: Ready
  - lastProbeTime: null
    lastTransitionTime: "2020-06-12T19:02:50Z"
    message: 'containers with unready status: [nginx-app]'
    reason: ContainersNotReady
    status: "False"
    type: ContainersReady
  - lastProbeTime: null
    lastTransitionTime: "2020-06-12T19:02:50Z"
    status: "True"
    type: PodScheduled
  containerStatuses:
  - image: nginx:212
    imageID: ""
    lastState: {}
    name: nginx-app
    ready: false
    restartCount: 0
    started: false
    state:
      waiting:
        message: Back-off pulling image "nginx:212"
        reason: ImagePullBackOff
  hostIP: 192.168.0.17
  phase: Pending
  podIP: 10.24.0.14
  podIPs:
  - ip: 10.24.0.14
  qosClass: BestEffort
  startTime: "2020-06-12T19:02:50Z"
```

### Describe the running Pod “nginx-app” ?
##### Command: `kubectl describe pod`

```sh
hugomatus@cloudshell:~ (binaria-273402)$ kubectl describe pod nginx-app
Name:         nginx-app
Namespace:    default
Priority:     0
Node:         gke-orion-k8-default-pool-55aa1bf3-fjcj/192.168.0.17
Start Time:   Fri, 12 Jun 2020 12:02:50 -0700
Labels:       run=nginx-app
Annotations:  cni.projectcalico.org/podIP: 10.24.0.14/32
Status:       Pending
IP:           10.24.0.14
IPs:
  IP:  10.24.0.14
Containers:
  nginx-app:
    Container ID:
    Image:          nginx:212
    Image ID:
    Port:           <none>
    Host Port:      <none>
    State:          Waiting
      Reason:       ImagePullBackOff
    Ready:          False
    Restart Count:  0
    Environment:    <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from default-token-cqt2q (ro)
Conditions:
  Type              Status
  Initialized       True
  Ready             False
  ContainersReady   False
  PodScheduled      True
Volumes:
  default-token-cqt2q:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  default-token-cqt2q
    Optional:    false
QoS Class:       BestEffort
Node-Selectors:  <none>
Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s
                 node.kubernetes.io/unreachable:NoExecute for 300s
Events:
  Type     Reason     Age                    From                                              Message
  ----     ------     ----                   ----                                              -------
  Normal   Scheduled  6m40s                  default-scheduler                                 Successfully assigned default/nginx-app to gke-orion-k8-default-pool-55aa1bf3-fjcj
  Normal   Pulling    5m4s (x4 over 6m39s)   kubelet, gke-orion-k8-default-pool-55aa1bf3-fjcj  Pulling image "nginx:212"
  Warning  Failed     5m3s (x4 over 6m38s)   kubelet, gke-orion-k8-default-pool-55aa1bf3-fjcj  Failed to pull image "nginx:212": rpc error: code = Unknown desc = Error response from daemon: pull access denied for nginx-bad-name, repository does not exist or may require 'docker login': denied: requested access to the resource is denied
  Warning  Failed     5m3s (x4 over 6m38s)   kubelet, gke-orion-k8-default-pool-55aa1bf3-fjcj  Error: ErrImagePull
  Normal   BackOff    4m52s (x6 over 6m37s)  kubelet, gke-orion-k8-default-pool-55aa1bf3-fjcj  Back-off pulling image "nginx:212"
```

### Determine the nodes current pods are deployed on?
##### Command: `kubectl get pod -o wide`

```sh
hugomatus@cloudshell:~ (binaria-273402)$ kubectl get pod -o wide
NAME        READY   STATUS             RESTARTS   AGE     IP           NODE                                      NOMINATED NODE   READINESS GATES
nginx       1/1     Running            0          11m     10.24.1.6    gke-orion-k8-default-pool-55aa1bf3-96ct   <none>           <none>
nginx-app   0/1     ImagePullBackOff   0          8m54s   10.24.0.14   gke-orion-k8-default-pool-55aa1bf3-fjcj   <none>           <none>
```

### Determine the status of the container in ‘nginx-app’ pod?
##### Command: `kubectl get pod -o wide`

```sh
hugomatus@cloudshell:~ (binaria-273402)$ kubectl get pod -o wide
NAME        READY   STATUS             RESTARTS   AGE     IP           NODE                                      NOMINATED NODE   READINESS GATES
nginx       1/1     Running            0          11m     10.24.1.6    gke-orion-k8-default-pool-55aa1bf3-96ct   <none>           <none>
nginx-app   0/1     ImagePullBackOff   0          8m54s   10.24.0.14   gke-orion-k8-default-pool-55aa1bf3-fjcj   <none>           <none>
```

### Delete the ‘nginx-app’ Pod.
##### Command: `kubectl delete pod`

```sh
hugomatus@cloudshell:~ (binaria-273402)$ kubectl delete pod nginx —force —grace-period=0
warning: Immediate deletion does not wait for confirmation that the running resource has been terminated. The resource may continue to run on the cluster indefinitely.
pod “nginx” force deleted
```

##### Command: `kubectl get pod -o wide`

```text
hugomatus@cloudshell:~ (binaria-273402)$ kubectl get pod -o wide
NAME        READY   STATUS             RESTARTS   AGE     IP           NODE                                      NOMINATED NODE   READINESS GATES
nginx       1/1     Running            0          11m     10.24.1.6    gke-orion-k8-default-pool-55aa1bf3-96ct   <none>           <none>
```

### Create a new pod with the following spec
##### Spec:
* Name: redis-app
* Image name: redis:789
* Namespace: default
* Use a pod-definition file

##### Command: `kubectl run`

```yaml
hugomatus@cloudshell:~ (binaria-273402)$ kubectl run redis-app --image=redis:789 --restart=Never --dry-run=client -o yaml > redis.yaml
```

##### Command: `cat redis.yaml`

```yaml
hugomatus@cloudshell:~ (binaria-273402)$ cat redis.yaml
apiVersion: v1
kind: Pod
metadata:
  creationTimestamp: null
  labels:
    run: redis-app
  name: redis-app
spec:
  containers:
  - image: redis:789
    name: redis-app
    resources: {}
  dnsPolicy: ClusterFirst
  restartPolicy: Never
status: {}
```

##### Command: `kubectl create -f`

```text
hugomatus@cloudshell:**~ (binaria-273402)**$ kubectl create -f redis.yaml
pod/redis-app created
```

##### Command: `kubectl get pod`

```text
NAME        READY   STATUS             RESTARTS   AGE
redis-app   0/1     ImagePullBackOff   0          28s
```

#### How would you fix the image on the pod with current spec below?
##### Spec:
* Name: redis-app
* Image name: redis:789
* Namespace: default

##### Command: `kubectl describe pod redis-app`

```text
Name:         redis-app
Namespace:    default
Priority:     0
Node:         gke-orion-k8-default-pool-55aa1bf3-fjcj/192.168.0.17
Start Time:   Tue, 16 Jun 2020 13:48:25 -0700
Labels:       run=redis-app
Annotations:  cni.projectcalico.org/podIP: 10.24.0.25/32
Status:       Pending
IP:           10.24.0.25
IPs:
  IP:  10.24.0.25
Containers:
  redis-app:
    Container ID:
    Image:          redis:789
    Image ID:
    Port:           <none>
    Host Port:      <none>
    State:          Waiting
      Reason:       ImagePullBackOff
    Ready:          False
    Restart Count:  0
    Environment:    <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from default-token-cqt2q (ro)
Conditions:
  Type              Status
  Initialized       True
  Ready             False
  ContainersReady   False
  PodScheduled      True
Volumes:
  default-token-cqt2q:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  default-token-cqt2q
    Optional:    false
QoS Class:       BestEffort
Node-Selectors:  <none>
Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s
                 node.kubernetes.io/unreachable:NoExecute for 300s
Events:
  Type     Reason          Age                    From                                              Message
  ----     ------          ----                   ----                                              -------
  Normal   Scheduled       3m14s                  default-scheduler                                 Successfully assigned default/redis-app to gke-orion-k8-default-pool-55aa1bf3-fjcj
  Normal   SandboxChanged  3m11s                  kubelet, gke-orion-k8-default-pool-55aa1bf3-fjcj  Pod sandbox changed, it will be killed and re-created.
  Warning  Failed          2m28s (x3 over 3m11s)  kubelet, gke-orion-k8-default-pool-55aa1bf3-fjcj  Failed to pull image "redis:789": rpc error: code = Unknown desc = Error response from daemon: manifest for redis:789 not found: manifest unknown: manifest unknown
  Warning  Failed          2m28s (x3 over 3m11s)  kubelet, gke-orion-k8-default-pool-55aa1bf3-fjcj  Error: ErrImagePull
  Normal   BackOff         110s (x7 over 3m10s)   kubelet, gke-orion-k8-default-pool-55aa1bf3-fjcj  Back-off pulling image "redis:789"
  Warning  Failed          110s (x7 over 3m10s)   kubelet, gke-orion-k8-default-pool-55aa1bf3-fjcj  Error: ImagePullBackOff
  Normal   Pulling         98s (x4 over 3m12s)    kubelet, gke-orion-k8-default-pool-55aa1bf3-fjcj  Pulling image "redis:789"

```

##### Command `kubectl set image`

```sh
hugomatus@cloudshell:~ (binaria-273402)$ kubectl set image pod redis-app redis-app=redis:latest
pod/redis-app image updated
```

##### Command `kubectl get pod`

```text
hugomatus@cloudshell:~ (binaria-273402)$ kubectl get pod redis-app
NAME        READY   STATUS    RESTARTS   AGE
redis-app   1/1     Running   0          8m18s
```

##### Command `kubectl describe pod`

```sh
hugomatus@cloudshell:~ (binaria-273402)$ kubectl describe pod redis-app
Name:         redis-app
Namespace:    default
Priority:     0
Node:         gke-orion-k8-default-pool-55aa1bf3-fjcj/192.168.0.17
hugomatus@cloudshell:~ (binaria-273402)$ kubectl describe pod redis-app
Name:         redis-app
Namespace:    default
Priority:     0
Node:         gke-orion-k8-default-pool-55aa1bf3-fjcj/192.168.0.17
Start Time:   Tue, 16 Jun 2020 13:48:25 -0700
Labels:       run=redis-app
Annotations:  cni.projectcalico.org/podIP: 10.24.0.25/32
Status:       Running
IP:           10.24.0.25
IPs:
  IP:  10.24.0.25
Containers:
  redis-app:
    Container ID:   docker://9d5b6b6c4208175a1eac1882686ef9e233edf5462a30c5044e80da4c2282e41f
    Image:          redis:latest
    Image ID:       docker-pullable://redis@sha256:76ff608805ca40008d6e0f08180d634732d8bf4728b85c18ab9bdbfa0911408d
    Port:           <none>
    Host Port:      <none>
    State:          Running
      Started:      Tue, 16 Jun 2020 13:56:37 -0700
    Ready:          True
    Restart Count:  0
    Environment:    <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from default-token-cqt2q (ro)
Conditions:
  Type              Status
  Initialized       True
  Ready             True
  ContainersReady   True
  PodScheduled      True
Volumes:
  default-token-cqt2q:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  default-token-cqt2q
    Optional:    false
QoS Class:       BestEffort
Node-Selectors:  <none>
Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s
                 node.kubernetes.io/unreachable:NoExecute for 300s
Events:
  Type     Reason          Age                   From                                              Message
  ----     ------          ----                  ----                                              -------
  Normal   Scheduled       10m                   default-scheduler                                 Successfully assigned default/redis-app to gke-orion-k8-default-pool-55aa1bf3-fjcj
  Normal   SandboxChanged  10m                   kubelet, gke-orion-k8-default-pool-55aa1bf3-fjcj  Pod sandbox changed, it will be killed and re-created.
  Warning  Failed          9m58s (x3 over 10m)   kubelet, gke-orion-k8-default-pool-55aa1bf3-fjcj  Failed to pull image "redis:789": rpc error: code = Unknown desc = Error response from daemon: manifest for redis:789 not found: manifest unknown: manifest unknown
  Warning  Failed          9m58s (x3 over 10m)   kubelet, gke-orion-k8-default-pool-55aa1bf3-fjcj  Error: ErrImagePull
  Normal   BackOff         9m20s (x7 over 10m)   kubelet, gke-orion-k8-default-pool-55aa1bf3-fjcj  Back-off pulling image "redis:789"
  Normal   Pulling         9m8s (x4 over 10m)    kubelet, gke-orion-k8-default-pool-55aa1bf3-fjcj  Pulling image "redis:789"
  Warning  Failed          5m40s (x22 over 10m)  kubelet, gke-orion-k8-default-pool-55aa1bf3-fjcj  Error: ImagePullBackOff
```


